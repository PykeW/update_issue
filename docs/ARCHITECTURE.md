# é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è®®é¢˜åŒæ­¥ç³»ç»Ÿï¼ˆIssue Sync Systemï¼‰æ˜¯ä¸€ä¸ªç”¨äºåŒæ­¥ WPS è¡¨æ ¼æ•°æ®åˆ° GitLab çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚

### æ ¸å¿ƒåŠŸèƒ½
- WPS æ•°æ®ä¸Šä¼ å’Œå¤„ç†
- GitLab è®®é¢˜åˆ›å»ºå’ŒçŠ¶æ€åŒæ­¥
- é˜Ÿåˆ—åŒ–ä»»åŠ¡å¤„ç†
- å®æ—¶çŠ¶æ€ç›‘æ§

## ğŸ—ï¸ ç›®å½•ç»“æ„

```
update_issue/
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ api/                      # API å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ wps_api.py           # WPS æ•°æ®ä¸Šä¼  API
â”‚   â”œâ”€â”€ gitlab/                   # GitLab åŒæ­¥æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ change_detector.py        # å˜æ›´æ£€æµ‹
â”‚   â”‚   â”‚   â”œâ”€â”€ config_manager.py         # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ database_manager.py       # æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ gitlab_operations.py      # GitLab æ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ gitlab_issue_manager.py   # è®®é¢˜ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ smart_queue_processor.py  # é˜Ÿåˆ—å¤„ç†
â”‚   â”‚   â””â”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ health_check.py          # å¥åº·æ£€æŸ¥
â”‚   â”‚       â”œâ”€â”€ log_rotation.py          # æ—¥å¿—è½®è½¬
â”‚   â”‚       â””â”€â”€ manual_sync.py           # æ‰‹åŠ¨åŒæ­¥
â”‚   â””â”€â”€ utils/                   # å·¥å…·æ¨¡å—
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ database_config.py          # æ•°æ®åº“é…ç½®
â”‚       â”œâ”€â”€ helpers.py                  # è¾…åŠ©å‡½æ•°
â”‚       â””â”€â”€ password_manager.py         # å¯†ç ç®¡ç†
â”œâ”€â”€ scripts/                      # å¯æ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ activate_venv.sh         # è™šæ‹Ÿç¯å¢ƒæ¿€æ´»
â”‚   â”œâ”€â”€ test_immediate_sync.py   # åŒæ­¥æµ‹è¯•
â”‚   â””â”€â”€ wps_upload_script_optimized.py  # ä¸Šä¼ è„šæœ¬
â”œâ”€â”€ config/                       # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ gitlab.env              # GitLab é…ç½®
â”‚   â”œâ”€â”€ database.env            # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ user_mapping.json       # ç”¨æˆ·æ˜ å°„
â”‚   â””â”€â”€ wps_gitlab_config.json  # WPS-GitLab é…ç½®
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md         # æ¶æ„æ–‡æ¡£ (æœ¬æ–‡ä»¶)
â”‚   â””â”€â”€ README.md               # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ tests/                        # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ venv/                         # è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ main.py                       # ç»Ÿä¸€å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ pyproject.toml               # é¡¹ç›®é…ç½®
â”œâ”€â”€ pyrightconfig.json           # ç±»å‹æ£€æŸ¥é…ç½®
â””â”€â”€ .gitignore                   # Git å¿½ç•¥é…ç½®
```

## ğŸ”„ æ•°æ®æµ

### 1. WPS æ•°æ®ä¸Šä¼ æµç¨‹
```
WPS è¡¨æ ¼ â†’ API æ¥æ”¶ â†’ æ•°æ®éªŒè¯ â†’ æ•°æ®åº“å­˜å‚¨ â†’ GitLab åŒæ­¥
```

### 2. GitLab åŒæ­¥æµç¨‹
```
æ•°æ®åº“å˜æ›´ â†’ ç«‹å³åŒæ­¥ â†’ æˆåŠŸ/å¤±è´¥
                    â†“ (å¤±è´¥)
                  åŒæ­¥é˜Ÿåˆ— â†’ æ‰¹é‡å¤„ç† â†’ GitLab
```

### 3. é˜Ÿåˆ—å¤„ç†æœºåˆ¶
```
pending â†’ processing â†’ completed/failed
```

## ğŸ¯ æ ¸å¿ƒæ¨¡å—è¯´æ˜

### API å±‚ (`src/api/`)
- **wps_api.py**: Flask API æœåŠ¡
  - `/api/wps/upload`: æ¥æ”¶ WPS æ•°æ®ä¸Šä¼ 
  - `/api/database/status`: æ•°æ®åº“çŠ¶æ€æŸ¥è¯¢
  - `/`: å¥åº·æ£€æŸ¥ç«¯ç‚¹

### GitLab æ ¸å¿ƒ (`src/gitlab/core/`)
- **database_manager.py**: æ•°æ®åº“æ“ä½œå°è£…
- **gitlab_operations.py**: GitLab API å°è£…
- **config_manager.py**: é…ç½®æ–‡ä»¶åŠ è½½
- **change_detector.py**: æ•°æ®å˜æ›´æ£€æµ‹
- **gitlab_issue_manager.py**: è®®é¢˜ç®¡ç†é€»è¾‘

### ä¸šåŠ¡æœåŠ¡ (`src/gitlab/services/`)
- **manual_sync.py**: æ‰‹åŠ¨æ‰¹é‡åŒæ­¥å·¥å…·
- **health_check.py**: ç³»ç»Ÿå¥åº·æ£€æŸ¥
- **log_rotation.py**: æ—¥å¿—æ–‡ä»¶ç®¡ç†

### å·¥å…·æ¨¡å— (`src/utils/`)
- **database_config.py**: æ•°æ®åº“é…ç½®ç®¡ç†
- **password_manager.py**: å¯†ç å®‰å…¨å­˜å‚¨
- **helpers.py**: é€šç”¨è¾…åŠ©å‡½æ•°

## ğŸ” é…ç½®ç®¡ç†

### é…ç½®æ–‡ä»¶å±‚æ¬¡
1. **ç¯å¢ƒå˜é‡**: æœ€é«˜ä¼˜å…ˆçº§
2. **config/*.env**: ç¯å¢ƒé…ç½®æ–‡ä»¶
3. **config/*.json**: JSON é…ç½®æ–‡ä»¶
4. **é»˜è®¤å€¼**: ä»£ç ä¸­çš„é»˜è®¤é…ç½®

### å…³é”®é…ç½®
- `config/gitlab.env`: GitLab URLã€Tokenã€Project ID
- `config/database.env`: æ•°æ®åº“è¿æ¥ä¿¡æ¯
- `config/user_mapping.json`: WPS ç”¨æˆ·åˆ° GitLab ç”¨æˆ·çš„æ˜ å°„

## ğŸš€ éƒ¨ç½²æ¶æ„

### æœåŠ¡ç»„ä»¶
1. **API æœåŠ¡**: Flask åº”ç”¨ (ç«¯å£ 80)
2. **æ•°æ®åº“**: MySQL
3. **GitLab**: å¤–éƒ¨ GitLab å®ä¾‹

### æ•°æ®æµå‘
```
WPSå®¢æˆ·ç«¯ â†’ APIæœåŠ¡ â†’ MySQLæ•°æ®åº“ â†â†’ GitLab
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Flask
- **æ•°æ®åº“**: MySQL
- **HTTP å®¢æˆ·ç«¯**: requests
- **ç±»å‹æ£€æŸ¥**: Basedpyright
- **ä»£ç æ ¼å¼åŒ–**: Black
- **è™šæ‹Ÿç¯å¢ƒ**: Python venv

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### issues è¡¨
- å­˜å‚¨è®®é¢˜ä¿¡æ¯
- ä¸»è¦å­—æ®µ: id, project_name, status, gitlab_url, sync_status

### sync_queue è¡¨
- åŒæ­¥ä»»åŠ¡é˜Ÿåˆ—
- ä¸»è¦å­—æ®µ: id, issue_id, action, status, priority

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨é€‚å½“çš„æ¨¡å—ä¸­æ·»åŠ ä»£ç 
2. æ›´æ–°ç›¸å…³å¯¼å…¥
3. æ·»åŠ æµ‹è¯•
4. æ›´æ–°æ–‡æ¡£

### æ¨¡å—ä¾èµ–è§„åˆ™
- `api/` å¯ä»¥ä¾èµ– `gitlab/` å’Œ `utils/`
- `gitlab/services/` å¯ä»¥ä¾èµ– `gitlab/core/` å’Œ `utils/`
- `gitlab/core/` å¯ä»¥ä¾èµ– `utils/`
- `utils/` ä¸åº”ä¾èµ–å…¶ä»–æ¨¡å—

## ğŸ“ æœ€ä½³å®è·µ

1. **å¯¼å…¥è·¯å¾„**: ä½¿ç”¨ç»å¯¹å¯¼å…¥ `from src.module import ...`
2. **é…ç½®ç®¡ç†**: é€šè¿‡ ConfigManager åŠ è½½é…ç½®
3. **æ•°æ®åº“æ“ä½œ**: é€šè¿‡ DatabaseManager æ‰§è¡Œ
4. **é”™è¯¯å¤„ç†**: ä½¿ç”¨ try-except å¹¶è®°å½•æ—¥å¿—
5. **ç±»å‹æ³¨è§£**: ä¸ºå‡½æ•°æ·»åŠ ç±»å‹æç¤º

## ğŸ”„ ç‰ˆæœ¬å†å²

### v2.0.0 (2025-10-20) - ä»£ç ç»“æ„é‡æ„
- é‡ç»„ç›®å½•ç»“æ„
- ç»Ÿä¸€å…¥å£ç‚¹ (main.py)
- é›†ä¸­é…ç½®æ–‡ä»¶
- æ”¹è¿›æ¨¡å—åŒ–è®¾è®¡

### v1.0.0 (2025-09-20) - åˆå§‹ç‰ˆæœ¬
- åŸºç¡€åŒæ­¥åŠŸèƒ½
- API æœåŠ¡
- é˜Ÿåˆ—å¤„ç†æœºåˆ¶

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
2. ç¼–å†™ä»£ç å’Œæµ‹è¯•
3. æäº¤ Pull Request
4. ä»£ç å®¡æŸ¥
5. åˆå¹¶åˆ°ä¸»åˆ†æ”¯

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿæˆ–æäº¤ Issueã€‚

